<!DOCTYPE html>
<html>
<head>
    <title>Ken Burns Effect Test - MMM-OneDrive</title>
    <link rel="stylesheet" href="MMM-OneDrive.css">
    <style>
        body {
            font-family: "Roboto Condensed", sans-serif;
            background-color: #000;
            color: #fff;
            padding: 20px;
            margin: 0;
        }
        
        .test-container {
            width: 800px;
            height: 600px;
            margin: 20px auto;
            border: 2px solid #333;
            position: relative;
        }
        
        .controls {
            text-align: center;
            margin: 20px;
        }
        
        button {
            background: #333;
            color: white;
            border: 1px solid #666;
            padding: 10px 20px;
            margin: 0 10px;
            cursor: pointer;
            border-radius: 4px;
        }
        
        button:hover {
            background: #555;
        }
        
        .info {
            text-align: center;
            margin: 20px;
            font-size: 14px;
            color: #aaa;
        }
    </style>
</head>
<body>
    <h1>Ken Burns Effect Test - MMM-OneDrive</h1>
    
    <div class="info">
        <p>This tests the Ken Burns crop-and-zoom-out effect. Each photo starts with a random crop and slowly zooms out to show the full image over 60 seconds.</p>
        <p>The blurred background is NOT affected by the Ken Burns effect (as required).</p>
    </div>
    
    <div class="controls">
        <button onclick="testWithSampleImage()">Test with Sample Image</button>
        <button onclick="testWithDifferentCrop()">Try Different Random Crop</button>
        <button onclick="toggleKenBurns()">Toggle Ken Burns On/Off</button>
        <button onclick="testLeftMargin()">Test Left Margin Layout</button>
        <button onclick="resetAnimation()">Reset Animation</button>
    </div>
    
    <div class="test-container">
        <div id="ONEDRIVE_PHOTO">
            <div id="ONEDRIVE_PHOTO_BACKDROP"></div>
            <div id="ONEDRIVE_PHOTO_CURRENT"></div>
            <div id="ONEDRIVE_PHOTO_INFO">
                <div class="albumCover" style="background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjYwIiBoZWlnaHQ9IjYwIiByeD0iMzAiIGZpbGw9IiNmZGQiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMSA5TDEzLjA5IDE1Ljc0TDEyIDIyTDEwLjkxIDE1Ljc0TDMgOUwxMC45MSA4LjI2TDEyIDJaIiBmaWxsPSIjMzMzIi8+Cjwvc3ZnPgo8L3N2Zz4K')"></div>
                <div class="infoText">
                    <div class="albumTitle">Test Album</div>
                    <div class="photoTime">2024/01/15 14:30</div>
                    <div class="photoLocation">Test Location</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="info">
        <p>Watch the foreground image: it should start cropped and slowly zoom out.</p>
        <p>The background should remain static and blurred (no Ken Burns effect).</p>
        <p>Animation duration: 2s fade + 60s Ken Burns (sped up to 10s for testing)</p>
    </div>

    <script>
        // Sample test image (landscape photo)
        const sampleImageUrl = 'data:image/svg+xml;base64,' + btoa(`
            <svg width="1200" height="800" viewBox="0 0 1200 800" fill="none" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="sky" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#87CEEB;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#E0F6FF;stop-opacity:1" />
                    </linearGradient>
                    <linearGradient id="mountain" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" style="stop-color:#8B7355;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#A0522D;stop-opacity:1" />
                    </linearGradient>
                </defs>
                
                <!-- Sky -->
                <rect width="1200" height="500" fill="url(#sky)"/>
                
                <!-- Mountains -->
                <polygon points="0,400 200,200 400,300 600,150 800,250 1000,180 1200,220 1200,500 0,500" fill="url(#mountain)"/>
                
                <!-- Trees -->
                <rect x="100" y="350" width="20" height="80" fill="#8B4513"/>
                <circle cx="110" cy="340" r="25" fill="#228B22"/>
                
                <rect x="300" y="320" width="25" height="100" fill="#8B4513"/>
                <circle cx="312" cy="310" r="30" fill="#228B22"/>
                
                <rect x="700" y="380" width="18" height="60" fill="#8B4513"/>
                <circle cx="709" cy="370" r="22" fill="#228B22"/>
                
                <!-- Lake -->
                <ellipse cx="600" cy="450" rx="200" ry="50" fill="#4682B4"/>
                
                <!-- Text overlay to see crop effect -->
                <text x="100" y="100" font-family="Arial" font-size="60" fill="#333">TOP LEFT</text>
                <text x="800" y="100" font-family="Arial" font-size="60" fill="#333">TOP RIGHT</text>
                <text x="100" y="750" font-family="Arial" font-size="60" fill="#333">BOTTOM LEFT</text>
                <text x="700" y="750" font-family="Arial" font-size="60" fill="#333">BOTTOM RIGHT</text>
                <text x="500" y="400" font-family="Arial" font-size="80" fill="#FFF" text-anchor="middle">CENTER</text>
            </svg>
        `);

        let kenBurnsEnabled = true;

        function generateRandomCrop() {
            const cropMargin = 0.15;
            const startX = Math.random() * (0.5 - 2 * cropMargin) + cropMargin;
            const startY = Math.random() * (0.5 - 2 * cropMargin) + cropMargin;
            const startScale = 1.25 + Math.random() * 0.35;
            
            return { startX, startY, startScale };
        }

        function applyKenBurns(crop) {
            const current = document.getElementById("ONEDRIVE_PHOTO_CURRENT");
            
            if (kenBurnsEnabled) {
                // Set CSS custom properties
                current.style.setProperty('--kb-start-x', `${crop.startX * 100}%`);
                current.style.setProperty('--kb-start-y', `${crop.startY * 100}%`);
                current.style.setProperty('--kb-start-scale', crop.startScale.toString());
                current.classList.add("ken-burns-enabled");
                
                console.log('Ken Burns ENABLED:', {
                    startX: `${crop.startX * 100}%`,
                    startY: `${crop.startY * 100}%`,
                    startScale: crop.startScale.toFixed(2)
                });
            } else {
                // Remove Ken Burns
                current.classList.remove("ken-burns-enabled");
                current.style.removeProperty('--kb-start-x');
                current.style.removeProperty('--kb-start-y');
                current.style.removeProperty('--kb-start-scale');
                
                console.log('Ken Burns DISABLED');
            }
        }

        function testWithSampleImage() {
            const back = document.getElementById("ONEDRIVE_PHOTO_BACKDROP");
            const current = document.getElementById("ONEDRIVE_PHOTO_CURRENT");
            
            // Remove animation class if present
            current.classList.remove("animated");
            
            // Set image
            back.style.backgroundImage = `url(${sampleImageUrl})`;
            current.style.backgroundImage = `url(${sampleImageUrl})`;
            
            // Generate and apply random crop
            const crop = generateRandomCrop();
            applyKenBurns(crop);
            
            // Start animation with a small delay
            setTimeout(() => {
                current.classList.add("animated");
            }, 100);
        }

        function testWithDifferentCrop() {
            const current = document.getElementById("ONEDRIVE_PHOTO_CURRENT");
            
            // Remove animation
            current.classList.remove("animated");
            
            // Apply new random crop
            const crop = generateRandomCrop();
            applyKenBurns(crop);
            
            // Restart animation
            setTimeout(() => {
                current.classList.add("animated");
            }, 100);
        }

        function toggleKenBurns() {
            kenBurnsEnabled = !kenBurnsEnabled;
            console.log('Ken Burns toggled:', kenBurnsEnabled ? 'ENABLED' : 'DISABLED');
            
            // Update button text
            const button = event.target;
            button.textContent = kenBurnsEnabled ? 'Toggle Ken Burns On/Off (ON)' : 'Toggle Ken Burns On/Off (OFF)';
            
            // Apply change immediately
            testWithDifferentCrop();
        }

        function testLeftMargin() {
            const container = document.querySelector('.test-container');
            const current = document.getElementById("ONEDRIVE_PHOTO_CURRENT");
            const back = document.getElementById("ONEDRIVE_PHOTO_BACKDROP");
            
            // Toggle left margin simulation
            if (current.style.left) {
                // Remove left margin
                current.style.left = '';
                current.style.width = '';
                // Keep backdrop full-width (don't change it)
                container.style.background = '';
                console.log('Left margin REMOVED');
            } else {
                // Apply left margin (simulate 25vw sidebar)
                const leftMargin = '200px'; // 25% of 800px container
                current.style.left = leftMargin;
                current.style.width = `calc(100% - ${leftMargin})`;
                // Keep backdrop full-width (don't apply margin to backdrop)
                container.style.background = 'linear-gradient(90deg, #333 200px, transparent 200px)';
                console.log('Left margin APPLIED to foreground only:', leftMargin);
            }
        }

        function resetAnimation() {
            const current = document.getElementById("ONEDRIVE_PHOTO_CURRENT");
            current.classList.remove("animated");
            
            setTimeout(() => {
                current.classList.add("animated");
            }, 100);
        }

        // Override animation duration for faster testing (optional)
        const style = document.createElement('style');
        style.textContent = `
            /* Speed up animation for testing - normally 60s 
               Comment out the line below to see full 60s duration */
            #ONEDRIVE_PHOTO_CURRENT.animated {
                animation-duration: 2s, 15s !important;
            }
        `;
        document.head.appendChild(style);

        // Auto-start with sample image
        window.onload = function() {
            testWithSampleImage();
        };
    </script>
</body>
</html>
