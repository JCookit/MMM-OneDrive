/*! *****************************************************************************
  MMM-OneDrive
  Version 1.6.0

  MagicMirrorÂ² module to display your photos from OneDrive.
  Please submit bugs at https://github.com/hermanho/MMM-OneDrive/issues

  (c) hermanho
  Licence: MIT

  This file is auto-generated. Do not edit.
***************************************************************************** */

!function(){"use strict";Module.register("MMM-OneDrive",{defaults:{albums:[],updateInterval:3e4,sort:"new",condition:{fromDate:null,toDate:null,minWidth:null,maxWidth:null,minHeight:null,maxHeight:null,minWHRatio:null,maxWHRatio:null},showWidth:1080,showHeight:1920,timeFormat:"YYYY/MM/DD HH:mm",autoInfoPosition:!1,forceAuthInteractive:!1,leftMargin:null,kenBurnsEffect:!0,kenBurnsCenterStart:!0,faceDetection:{enabled:!0,minFaceSize:50,maxFaceSize:300,confidenceThreshold:.5,debugMode:!1}},requiresVersion:"2.24.0",suspended:!1,getScripts:()=>["moment.js"],getStyles:function(){return["MMM-OneDrive.css"]},start:function(){this.firstScan=!0,this.config.updateInterval<1e4&&(this.config.updateInterval=1e4),this.config.condition=Object.assign({},this.defaults.condition,this.config.condition);const e=Object.assign({},this.config);for(let t=0;t<this.config.albums.length;t++){const n=this.config.albums[t];n instanceof RegExp&&(e.albums[t]={source:n.source,flags:n.flags})}this.sendSocketNotification("INIT",e),this.dynamicPosition=0},socketNotificationReceived:function(e,t){if("ERROR"===e){const e=document.getElementById("ONEDRIVE_PHOTO_CURRENT");e.textContent="";const n=document.createElement("div");Object.assign(n.style,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"});const i=document.createElement("div");Object.assign(i.style,{maxWidth:"70vw",fontSize:"1.5em"}),i.textContent=t,n.appendChild(i),e.appendChild(n)}if("CLEAR_ERROR"===e){document.getElementById("ONEDRIVE_PHOTO_CURRENT").textContent=""}if("UPDATE_STATUS"===e){document.getElementById("ONEDRIVE_PHOTO_INFO").innerHTML=String(t)}if("RENDER_PHOTO"===e){this.state={type:"newPhoto",payload:t};const{photo:e,photoBase64:n,album:i,interestingRectangleResult:o}=t,a=`data:${"image/heic"===e.mimeType?"image/jpeg":e.mimeType};base64,${n}`,s=(null==o?void 0:o.markedImageUrl)||a,d=(null==o?void 0:o.focalPoint)||null;this.render(s,e,i,d)}},notificationReceived:function(e,t,n){"ONEDRIVE_PHOTO_NEXT"===e&&this.sendSocketNotification("NEXT_PHOTO",[])},createKenBurnsKeyframes:function(e,t,n,i,o,a,s){const d=1/s*100,l=(s-1)/s*100;let c=1;if(i&&o&&a){const e=i.width/o*100,t=i.height/a*100,n=100/e,s=100/t,d=Math.min(n,s);c=Math.max(1.1,Math.min(10,d)),console.debug("[MMM-OneDrive] Focal point scale calculation:",{focalWidthPercent:e.toFixed(1),focalHeightPercent:t.toFixed(1),scaleForWidth:n.toFixed(2),scaleForHeight:s.toFixed(2),optimalScale:d.toFixed(2),finalStartScale:c.toFixed(2)})}let r=0,m=0;if(i&&!1!==this.config.kenBurnsCenterStart){const e=t,i=n;r=50-e,m=50-i,console.debug("[MMM-OneDrive] Pan calculation:",{focalCenter:`${e.toFixed(1)}%, ${i.toFixed(1)}%`,translation:`${r.toFixed(1)}%, ${m.toFixed(1)}%`,finalPosition:"50%, 50% (screen center)"})}const u=`\n      @keyframes ${e} {\n        0% {\n          opacity: 0;\n          transform: scale(${c}) translate(${r}%, ${m}%) ;\n        }\n        ${d.toFixed(3)}% {\n          opacity: 1;\n        }\n        ${l.toFixed(3)}% {\n          opacity: 1;\n        }\n        100% {\n          opacity: 0;\n          transform: translate(0%, 0%) scale(1.0);\n        }\n      }\n    `,h=document.getElementById(e);h&&h.remove();const f=document.createElement("style");f.id=e,f.textContent=u,document.head.appendChild(f)},render:function(e,t,n,i){var o,a;if(this.suspended)return void console.debug("[MMM-OneDrive] Module is suspended, skipping render");const s=new Date,d=document.getElementById("ONEDRIVE_PHOTO_BACKDROP"),l=document.getElementById("ONEDRIVE_PHOTO_CURRENT");if(l.textContent="",d.style.backgroundImage=`url(${e})`,l.style.backgroundImage=`url(${e})`,this.config.leftMargin){let e=document.getElementById("ONEDRIVE_PHOTO_CLIP_WRAPPER");if(!e){e=document.createElement("div"),e.id="ONEDRIVE_PHOTO_CLIP_WRAPPER",e.style.position="absolute",e.style.overflow="hidden",e.style.top="10px",e.style.bottom="10px";l.parentNode.insertBefore(e,l),e.appendChild(l)}e.style.left=this.config.leftMargin,e.style.right="10px",l.style.left="0",l.style.right="0",l.style.top="0",l.style.bottom="0",l.style.width="100%",l.style.height="100%",l.style.overflow="",l.style.backgroundPosition="center center",l.style.backgroundSize="contain"}else{const e=document.getElementById("ONEDRIVE_PHOTO_CLIP_WRAPPER");if(e){const t=e.parentNode;t.insertBefore(l,e),t.removeChild(e),l.style.left="10px",l.style.right="10px",l.style.top="10px",l.style.bottom="10px"}}if(!1!==this.config.kenBurnsEffect)if(i){const e=Number(null===(o=t.mediaMetadata)||void 0===o?void 0:o.width),n=Number(null===(a=t.mediaMetadata)||void 0===a?void 0:a.height);if(e&&n){let o=100*((i.x+i.width/2)/e),a=100*((i.y+i.height/2)/n);o=Math.max(20,Math.min(80,o)),a=Math.max(20,Math.min(80,a)),console.log(`[MMM-OneDrive] Using face-detected focal point: ${o.toFixed(1)}%, ${a.toFixed(1)}%`),this.applyKenBurnsAnimation(l,o,a,t,i)}else{console.warn("[MMM-OneDrive] Missing image dimensions for focal point conversion, using random");const e=60*Math.random()+20,n=60*Math.random()+20;this.applyKenBurnsAnimation(l,e,n,t)}}else{const e=60*Math.random()+20,n=60*Math.random()+20;console.log(`[MMM-OneDrive] Using random focal point: ${e.toFixed(1)}%, ${n.toFixed(1)}%`),this.applyKenBurnsAnimation(l,e,n,t)}else l.style.removeProperty("animation"),l.style.removeProperty("overflow");this.applyCommonStyling(l,t,n,s)},applyKenBurnsAnimation:function(e,t,n,i,o){var a,s;const d=this.config.updateInterval/1e3+2,l=`ken-burns-${Date.now()}-${Math.floor(1e3*Math.random())}`,c=Number(null===(a=i.mediaMetadata)||void 0===a?void 0:a.width)||0,r=Number(null===(s=i.mediaMetadata)||void 0===s?void 0:s.height)||0;this.createKenBurnsKeyframes(l,t,n,o,c,r,d),e.style.animation=`${l} ${d}s linear forwards`,e.style.overflow="hidden",console.debug("[MMM-OneDrive] Ken Burns animation:",{animationName:l,origin:`${t}% ${n}%`,totalDuration:`${d}s`,filename:i.filename,hasFocalPoint:!!o})},applyCommonStyling:function(e,t,n,i){var o,a;e.classList.add("animated");const s=document.getElementById("ONEDRIVE_PHOTO_INFO");if(this.config.autoInfoPosition){let e=(e,t)=>{const n=new Date;return[[0,"none","none",0],["none","none",0,0],["none",0,0,"none"],[0,0,"none","none"]][Math.floor(n.getMinutes()/15)]};"function"==typeof this.config.autoInfoPosition&&(e=this.config.autoInfoPosition);const[i,o,a,d]=e(n,t);s.style.setProperty("--top",String(i)),s.style.setProperty("--left",String(o)),s.style.setProperty("--bottom",String(a)),s.style.setProperty("--right",String(d))}s.innerHTML="";let d,l;t._folderId&&!n.bundle?(d=document.createElement("div"),d.classList.add("folderIcon"),d.innerHTML="",l=document.createElement("div"),l.classList.add("folderTitle"),l.innerHTML=n.name):(d=document.createElement("div"),d.classList.add("albumCover"),d.style.backgroundImage=`url(modules/MMM-OneDrive/cache/${n.id})`,l=document.createElement("div"),l.classList.add("albumTitle"),l.innerHTML=n.name);const c=document.createElement("div");c.classList.add("photoTime"),c.innerHTML="relative"===this.config.timeFormat?moment(t.mediaMetadata.dateTimeOriginal).fromNow():moment(t.mediaMetadata.dateTimeOriginal).format(this.config.timeFormat);const r=document.createElement("div");if(r.classList.add("photoLocation"),t.mediaMetadata.location){const e=t.mediaMetadata.location;if(e.city||e.state||e.country){const t=[e.city];!e.state||"united states"!==(null===(o=e.country)||void 0===o?void 0:o.toLowerCase())&&"canada"!==(null===(a=e.country)||void 0===a?void 0:a.toLowerCase())&&e.city||t.push(e.state),e.country&&t.push(e.country),r.innerHTML=t.filter(Boolean).join(", ")}else e.latitude&&e.longitude&&(r.innerHTML=`${e.latitude.toFixed(4)}, ${e.longitude.toFixed(4)}`)}const m=document.createElement("div");m.classList.add("infoText"),s.appendChild(d),m.appendChild(l),m.appendChild(c),r.innerHTML&&m.appendChild(r),s.appendChild(m),console.debug("[MMM-OneDrive] render image done",JSON.stringify({id:t.id,filename:t.filename,duration:(new Date).getTime()-i.getTime()})),this.sendSocketNotification("IMAGE_LOADED",{id:t.id,filename:t.filename,indexOfPhotos:t._indexOfPhotos})},getDom:function(){const e=document.createElement("div");e.id="ONEDRIVE_PHOTO";const t=document.createElement("div");t.id="ONEDRIVE_PHOTO_BACKDROP";const n=document.createElement("div");n.id="ONEDRIVE_PHOTO_CURRENT",-1===this.data.position.search("fullscreen")&&(this.config.showWidth&&(e.style.width=this.config.showWidth+"px"),this.config.showHeight&&(e.style.height=this.config.showHeight+"px")),n.addEventListener("animationend",(()=>{n.classList.remove("animated")}));const i=document.createElement("div");return i.id="ONEDRIVE_PHOTO_INFO",i.innerHTML="Loading...",e.appendChild(t),e.appendChild(n),e.appendChild(i),console.info("[MMM-OneDrive] Dom updated!"),e},suspend(){this.sendSocketNotification("MODULE_SUSPENDED",void 0),this.suspended=!0;document.getElementById("ONEDRIVE_PHOTO_INFO").innerHTML=""},resume(){this.sendSocketNotification("MODULE_RESUMED",void 0),this.suspended=!1}})}();
//# sourceMappingURL=MMM-OneDrive.js.map
